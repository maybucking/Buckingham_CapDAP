---
title: "Data Analyses"
author: "May"
date: "11/8/2022"
output: html_document
---
Let's analyze the American Kestrel Dataset!

First, lets clear r's brain and add packages
```{r}
rm(list = ls())
library(tidyverse)
library(dplyr)
library(ggplot2)
library(here)
```
Now lets import the data
```{r}
kestrels <- read.csv(here("Data", "AMKE DATA TABLE 1.csv"))
```
Now lets analyze the data
First lets do a summary of all of the data to look at means and spread of data
```{r}
summary(kestrels)
```
Now lets look at a scatterplot of the percent successful boxes to see if there are any outliers and to get a general sense of the relationship between box number (x) and percent success (y)
```{r}
ggplot(kestrels, aes(x = BOX, y = X.Successful)) + geom_point(size =1)+
xlab("Box Number") +
ylab("% Success")
```
Does not look like there are too many outliers, data looks pretty uniform

Now lets look at a scatterplot of the relationship between number of chicks banded (y) and box number (x)
```{r}
ggplot(kestrels, aes(x = BOX, y = Num_Chicks_Banded)) + geom_point(size =1)+
xlab("Box Number") +
ylab("Chicks banded")
```
Looks like there could be an outlier around the 10th box (close to 30 chicks banded) 

Now lets create a histogram of the percent success so we can see the data in a different format and not in relation to box number.
```{r}
ggplot(kestrels, aes(x = X.Successful)) + geom_histogram(bins = 10)+
  xlab("Percent Success")
```
There is a gap around 10% 

looking at unique characters but i dont think this is very useful to me.
```{r}
unique(kestrels)
```
```{r}
kestrels_long <- pivot_longer(kestrels, cols = X2002_inhabitants:X2013_inhabitants, names_to = "year", values_to = "inhabitants")
```

lets get rid of X and _inhabitants with string R to tidy up the data:
```{r}
kestrels_long1 <-str_replace(kestrels_long$year, "X", "")

kestrels_long$newYear <- kestrels_long1
view(kestrels_long)
```
```{r}
kestrels_long <- select(kestrels_long, - year)
```
```{r}
kestrels_long1 <- str_replace(kestrels_long$newYear, "_inhabitants", "")
kestrels_long$Year <- kestrels_long1
view(kestrels_long)
```
```{r}
kestrels_long <- select(kestrels_long, -newYear)
view(kestrels_long)
```

Tidy up inhabitants variable values so that they are uniform
```{r}
EMPTY <-which(kestrels_long$inhabitants == "EMPTY" | kestrels_long$inhabitants == "Empty" | kestrels_long$inhabitants == "empty" | kestrels_long$inhabitants == "FAILED" | kestrels_long$inhabitants == "failed" | kestrels_long$inhabitants == "Failed" | kestrels_long$inhabitants == "FAIL")
kestrels_long$inhabitants[EMPTY] <- "EMPTY"
view(kestrels_long)
```
```{r}
GRACKLE <-which(kestrels_long$inhabitants == "GRACKLE" | kestrels_long$inhabitants == "Grackle" | kestrels_long$inhabitants == "grackle" | kestrels_long$inhabitants == "GRACKLES" | kestrels_long$inhabitants == "Grackles" | kestrels_long$inhabitants == "grackles")
kestrels_long$inhabitants[GRACKLE] <- "GRACKLE"
view(kestrels_long)
```
```{r}
TREESWALLOW <-which(kestrels_long$inhabitants == "Tree Swallows" | kestrels_long$inhabitants == "TREE SWALLOW" )
kestrels_long$inhabitants[TREESWALLOW] <- "TREESWALLOW"
view(kestrels_long)
```
```{r}
STARLING <-which(kestrels_long$inhabitants == "STARLING" | kestrels_long$inhabitants == "STARLINGS" | kestrels_long$inhabitants == "Starling" | kestrels_long$inhabitants == "Starlings" | kestrels_long$inhabitants == "starlings" | kestrels_long$inhabitants == "starling")
kestrels_long$inhabitants[STARLING] <- "STARLING"
view(kestrels_long)
```
```{r}
INSECTS <-which(kestrels_long$inhabitants == "BEES" | kestrels_long$inhabitants == "Bees" | kestrels_long$inhabitants == "bees" | kestrels_long$inhabitants == "ANTS" | kestrels_long$inhabitants == "Ants" | kestrels_long$inhabitants == "ants")
kestrels_long$inhabitants[INSECTS] <- "INSECTS"
view(kestrels_long)
```

```{r}
KESTRELS <-which(kestrels_long$inhabitants == "KESTRELS" | kestrels_long$inhabitants == "Kestrels" | kestrels_long$inhabitants == "KESTREL" | kestrels_long$inhabitants == "FLEDGED" | kestrels_long$inhabitants == "Fledged" | kestrels_long$inhabitants == "fledged" | kestrels_long$inhabitants == "kestrels" )
kestrels_long$inhabitants[KESTRELS] <- "KESTRELS"
```
filter the data
```{r}
kestrels_long2 <- filter(kestrels_long, inhabitants == "KESTRELS" | inhabitants == "INSECTS" | inhabitants == "STARLING" | inhabitants == "TREESWALLOW" | inhabitants == "GRACKLE" | inhabitants == "EMPTY")
```

```{r}
kestrels_long2$inhabitants <- as.factor(kestrels_long2$inhabitants)
```

```{r}
ggplot(kestrels_long2, aes(inhabitants, X.Successful)) + 
  geom_boxplot()+
  geom_point()
```

```{r}

myMod <-lm(X.Successful ~ inhabitants, data = kestrels_long2)

```
```{r}
library(ggfortify)
```

```{r}

autoplot(myMod, smooth.color = NA)

```

```{r}
anova(myMod)
```
```{r}
summary(myMod)
```
```{r}
ggplot(kestrels_long2, aes(inhabitants, X.Successful)) + 
  geom_boxplot()+
  geom_point()
```

Now save the data frame
```{r}
write.csv(kestrels_long, here("Data", "processed", "Correct_kestrelsX"))
write.csv(kestrels_long, here("Data", "processed", "Correct_kestrels"), row.names = FALSE)
```


```{r}
library(lubridate)
```






